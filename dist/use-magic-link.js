function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var n=require("react"),t=e(require("event-emitter")),r=e(require("isomorphic-unfetch")),o=require("async-sema"),u=function(e){try{return s?Promise.resolve(s):e&&c?(s=new c(e),Promise.resolve(s)):(l||((l=window.document.createElement("script")).async=!0,l.src="https://cdn.jsdelivr.net/npm/magic-sdk/dist/magic.js",l.id="magic-link-sdk",l.onload=function(){c=window.Magic,i.emit("loaded")},document.head.appendChild(l)),e?Promise.resolve(new Promise(function(n){i.once("loaded",function(){s||(s=new c(e)),n(s)})})):Promise.resolve())}catch(e){return Promise.reject(e)}},i=new t,c=null,l=null,s=null;function f(e,n){try{var t=e()}catch(e){return n(e)}return t&&t.then?t.then(void 0,n):t}function a(e,n){try{var t=e()}catch(e){return n(!0,e)}return t&&t.then?t.then(n.bind(null,!1),n.bind(null,!0)):n(!1,t)}var h=function(e){try{return Promise.resolve(d.acquire()).then(function(){return a(function(){return P&&P.expiredAt>Date.now()?P.token:Promise.resolve(u(e)).then(function(e){return Promise.resolve(e.user.getIdToken()).then(function(e){return w(e),e})})},function(e,n){if(d.release(),e)throw n;return n})})}catch(e){return Promise.reject(e)}},d=new o.Sema(1),m=new o.Sema(1),g=new t,v=null,P=null;function w(e,n){void 0===n&&(n=9e5),P={token:e,expiredAt:Date.now()+n-6e4}}"undefined"!=typeof window&&u(),module.exports=function(e){if(!e)throw new Error("Magic Link publishableKey required as the first argument");var t=n.useState(null!==v&&v),o=t[0],i=t[1],c=n.useState(null===v),l=c[0],s=c[1],d=n.useState(null),y=d[0],p=d[1],j=n.useState(!1),k=j[0],q=j[1],I=n.useState(!1),S=I[0],b=I[1];return n.useEffect(function(){function n(e){i(e)}return v||function(e){try{return Promise.resolve(m.acquire()).then(function(){var n,t=a(function(){return f(function(){return null!==v?(n=1,v):Promise.resolve(h(e)).then(function(){v=!0})},function(){v=!1})},function(e,n){if(m.release(),e)throw n;return n});return t&&t.then?t.then(function(e){return n?e:v}):n?t:v})}catch(e){return Promise.reject(e)}}(e).then(function(e){i(e)}).then(function(){return s(!1)}),g.on("loggedIn",n),function(){g.off("loggedIn",n)}},[v]),{loggedIn:o,loading:l,error:y,loggingIn:k,loggingOut:S,login:function(n){try{p(null),q(!0);var t=a(function(){return f(function(){return Promise.resolve(u(e)).then(function(e){return Promise.resolve(e.auth.loginWithMagicLink({email:n})).then(function(e){v=!0,w(e),g.emit("loggedIn",!0),i(!0)})})},function(e){p(e)})},function(e,n){if(q(!1),e)throw n;return n});return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},logout:function(){try{p(null),b(!0);var n=a(function(){return f(function(){return Promise.resolve(u(e)).then(function(e){return Promise.resolve(e.user.logout()).then(function(){v=null,P=null,g.emit("loggedIn",!1),i(!1)})})},function(e){p(e)})},function(e,n){if(b(!1),e)throw n;return n});return Promise.resolve(n&&n.then?n.then(function(){return null===v}):null===v)}catch(e){return Promise.reject(e)}},fetch:function(n,t){void 0===t&&(t={});try{return Promise.resolve(h(e)).then(function(e){return e&&(t.headers=t.headers||{},t.headers.Authorization="Bearer "+e),r(n,t)})}catch(e){return Promise.reject(e)}},loginEvents:g,magic:magic}};
//# sourceMappingURL=use-magic-link.js.map
